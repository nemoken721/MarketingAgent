# 本番環境テストチェックリスト

デプロイ後の本番環境で実施するテスト項目をまとめています。すべてのテストに合格してから、ユーザーに公開してください。

## 目次

1. [事前準備](#事前準備)
2. [認証機能テスト](#認証機能テスト)
3. [ダッシュボード機能テスト](#ダッシュボード機能テスト)
4. [クレジット機能テスト](#クレジット機能テスト)
5. [AI機能テスト](#ai機能テスト)
6. [画像生成機能テスト](#画像生成機能テスト)
7. [お問い合わせ機能テスト](#お問い合わせ機能テスト)
8. [設定機能テスト](#設定機能テスト)
9. [パフォーマンステスト](#パフォーマンステスト)
10. [アクセシビリティテスト](#アクセシビリティテスト)
11. [ブラウザ互換性テスト](#ブラウザ互換性テスト)
12. [モバイル対応テスト](#モバイル対応テスト)
13. [エラーハンドリングテスト](#エラーハンドリングテスト)
14. [セキュリティテスト](#セキュリティテスト)

---

## 事前準備

### テスト環境

- [ ] **本番環境URLにアクセスできる**
  - URL: `https://your-domain.com`
  - SSL証明書が有効（鍵マークが表示される）

- [ ] **テストアカウントを作成**
  - テスト用メールアドレスを用意
  - 本番データベースに影響しないアカウント

- [ ] **テスト用ブラウザ**
  - Chrome（最新版）
  - Firefox（最新版）
  - Safari（最新版）
  - Edge（最新版）

- [ ] **テスト用デバイス**
  - デスクトップ（Windows/Mac）
  - モバイル（iOS/Android）
  - タブレット

---

## 認証機能テスト

### サインアップ

- [ ] **新規アカウント作成が成功する**
  1. トップページの「始める」ボタンをクリック
  2. メールアドレスとパスワードを入力
  3. 「アカウント作成」をクリック
  4. 確認メールが届く
  5. メール内のリンクをクリックしてアカウントを有効化

- [ ] **バリデーションが機能する**
  - 無効なメールアドレスでエラー表示
  - 短いパスワード（8文字未満）でエラー表示
  - 空欄で送信するとエラー表示

- [ ] **確認メールが正しく送信される**
  - 送信元アドレスが正しい（`RESEND_FROM_EMAIL`）
  - リンクをクリックするとログイン状態になる
  - リンクの有効期限が適切

- [ ] **初期クレジットが付与される**
  - 新規ユーザーに100クレジットが自動付与

### ログイン

- [ ] **既存アカウントでログインできる**
  1. 「ログイン」リンクをクリック
  2. メールアドレスとパスワードを入力
  3. ログイン成功後、ダッシュボードにリダイレクト

- [ ] **ログインエラーが適切に表示される**
  - 間違ったパスワードでエラー表示
  - 存在しないメールアドレスでエラー表示

- [ ] **セッション管理が機能する**
  - ログイン状態がページリロード後も維持される
  - ブラウザを閉じて再度開いてもログイン状態が維持される

### パスワードリセット

- [ ] **パスワードリセットが機能する**
  1. 「パスワードを忘れた方」をクリック
  2. メールアドレスを入力
  3. リセットメールが届く
  4. メール内のリンクをクリック
  5. 新しいパスワードを設定
  6. 新しいパスワードでログインできる

### ログアウト

- [ ] **ログアウトが機能する**
  1. サイドバーの「ログアウト」をクリック
  2. トップページにリダイレクト
  3. 認証が必要なページにアクセスするとログインページにリダイレクト

---

## ダッシュボード機能テスト

### 統計表示

- [ ] **ダッシュボードが正しく表示される**
  - 4つの統計カード（総投稿数、スケジュール済み、今日の投稿、平均エンゲージメント）
  - クレジット使用グラフ（Recharts）
  - プラットフォーム分布
  - 最近のアクティビティ

- [ ] **データが正しく表示される**
  - 統計数値が実際のデータと一致
  - グラフに過去7日間のデータが表示される
  - アクティビティが時系列順に表示される

- [ ] **レスポンシブデザインが機能する**
  - モバイルでグリッドレイアウトが1列になる
  - タブレットで2列レイアウトになる
  - デスクトップで4列レイアウトになる

---

## クレジット機能テスト

### クレジット表示

- [ ] **現在のクレジット残高が表示される**
  - サイドバーにクレジット残高が表示
  - 正確な数値が表示される

- [ ] **クレジット履歴が表示される**
  - ダッシュボードの「最近のアクティビティ」に履歴が表示
  - 使用・購入が色分けされている（赤：使用、緑：購入）

### クレジット購入

- [ ] **クレジット購入モーダルが開く**
  1. サイドバーの「+」ボタンをクリック
  2. モーダルが表示される

- [ ] **購入プランが表示される**
  - 100クレジット - ¥1,000
  - 500クレジット - ¥4,500（10%オフ）
  - 1000クレジット - ¥8,000（20%オフ）

- [ ] **Stripe決済が機能する**
  1. プランを選択
  2. 「購入する」をクリック
  3. Stripe Checkoutページにリダイレクト
  4. テストカード番号を入力：`4242 4242 4242 4242`
  5. 有効期限：将来の日付（例：12/34）
  6. CVC：任意の3桁（例：123）
  7. 決済成功後、元のページにリダイレクト
  8. クレジット残高が更新される
  9. 成功トーストが表示される

- [ ] **Webhook処理が成功する**
  - Stripe Dashboard > Webhooks でイベントログを確認
  - `checkout.session.completed` イベントが処理済み
  - データベースに購入履歴が記録されている

---

## AI機能テスト

### AIチャット

- [ ] **チャットインターフェースが表示される**
  - メッセージ入力欄
  - 送信ボタン
  - 画像生成ボタン

- [ ] **AIチャットが機能する**
  1. チャット入力欄にメッセージを入力
  2. 送信ボタンをクリック
  3. ローディング状態が表示される
  4. AI応答が表示される
  5. クレジットが消費される（10pt）

- [ ] **クレジット不足時のエラー処理**
  - クレジットが10pt未満の場合、エラートーストが表示
  - 購入を促すメッセージが表示

---

## 画像生成機能テスト

### DALL-E 3画像生成

- [ ] **画像生成モーダルが開く**
  1. チャットインターフェースの画像アイコンをクリック
  2. モーダルが表示される

- [ ] **画像生成が成功する**
  1. プロンプトを入力（例：「夕日を背景に立つ猫」）
  2. サイズを選択（1024x1024 / 1024x1792 / 1792x1024）
  3. 品質を選択（標準 / HD）
  4. 「生成」ボタンをクリック
  5. ローディング状態が表示される
  6. 生成された画像が表示される
  7. クレジットが消費される（100pt）
  8. 成功トーストと紙吹雪アニメーションが表示される

- [ ] **生成された画像の操作**
  - 画像が正しく表示される
  - 「ダウンロード」ボタンで画像をダウンロードできる
  - 「もう一度生成」ボタンで再生成できる

- [ ] **エラーハンドリング**
  - クレジット不足（100pt未満）でエラートーストが表示
  - OpenAI APIエラー時にエラートーストが表示
  - 不適切なプロンプトで OpenAI のコンテンツポリシーエラーが表示

---

## お問い合わせ機能テスト

### お問い合わせフォーム

- [ ] **お問い合わせページが表示される**
  - URL: `/contact`
  - フォームフィールド：名前、メールアドレス、件名、メッセージ

- [ ] **バリデーションが機能する**
  - 空欄で送信するとエラー表示
  - 無効なメールアドレスでエラー表示
  - メッセージが10文字未満でエラー表示

- [ ] **お問い合わせ送信が成功する**
  1. すべてのフィールドに入力
  2. 「送信」ボタンをクリック
  3. ローディング状態が表示される
  4. 成功画面が表示される
  5. 成功トーストが表示される

- [ ] **メール送信が機能する**
  - 管理者メール（`ADMIN_EMAIL`）にお問い合わせメールが届く
  - 送信者に自動返信メールが届く
  - メール内容が正しい（名前、メールアドレス、件名、メッセージ）

- [ ] **Resend Dashboard で確認**
  - Resend Dashboard > Logs でメール送信ログを確認
  - 2通のメールが送信されている（管理者宛 + 自動返信）
  - ステータスが「Delivered」

---

## 設定機能テスト

### アカウント設定

- [ ] **設定ページが表示される**
  - URL: `/settings`
  - アカウント情報セクション
  - 連携設定セクション
  - 危険な操作セクション

- [ ] **メールアドレス変更**
  1. 新しいメールアドレスを入力
  2. 「更新」ボタンをクリック
  3. 確認メールが送信される
  4. メール内のリンクをクリックしてメールアドレスを確認

- [ ] **パスワード変更**
  1. 新しいパスワードを入力
  2. 「更新」ボタンをクリック
  3. 成功トーストが表示される
  4. 新しいパスワードでログインできる

### アカウント削除

- [ ] **アカウント削除が機能する**
  1. 「アカウントを削除」セクションを開く
  2. 確認入力欄に「削除」と入力
  3. 「削除」ボタンをクリック
  4. 確認ダイアログが表示される
  5. 「はい、削除します」をクリック
  6. アカウントが削除される
  7. トップページにリダイレクト
  8. データベースからユーザーデータが削除される（RLS により関連データも削除）

---

## パフォーマンステスト

### Lighthouse スコア

- [ ] **Chrome DevTools > Lighthouse でテスト**
  1. 本番環境のURLを開く
  2. DevTools を開く（F12）
  3. Lighthouse タブを選択
  4. "Generate report" をクリック

- [ ] **目標スコア**
  - **Performance**: 90点以上
  - **Accessibility**: 90点以上
  - **Best Practices**: 90点以上
  - **SEO**: 90点以上

### Core Web Vitals

- [ ] **PageSpeed Insights でテスト**
  - URL: https://pagespeed.web.dev/
  - 本番環境のURLを入力
  - モバイル・デスクトップ両方でテスト

- [ ] **目標値**
  - **LCP (Largest Contentful Paint)**: < 2.5秒
  - **FID (First Input Delay)**: < 100ms
  - **CLS (Cumulative Layout Shift)**: < 0.1

### ページ読み込み速度

- [ ] **初回アクセス時の読み込み**
  - トップページ: < 3秒
  - ダッシュボード: < 3秒
  - チャットページ: < 3秒

- [ ] **キャッシュ利用時の読み込み**
  - 2回目以降のアクセス: < 1秒

### 画像最適化

- [ ] **Next.js Image コンポーネントが機能**
  - 画像が AVIF/WebP 形式で配信される
  - レスポンシブ画像が適切に読み込まれる
  - 遅延読み込み（Lazy Loading）が機能する

### コード分割

- [ ] **Lazy Components が機能**
  - モーダルコンポーネントが動的にインポートされる
  - 初期バンドルサイズが削減されている

---

## アクセシビリティテスト

### キーボードナビゲーション

- [ ] **Tabキーでフォーカス移動**
  - フォーカス順序が論理的
  - フォーカス可視性が高い（アウトライン表示）
  - すべてのインタラクティブ要素にアクセス可能

- [ ] **Enterキーでボタン押下**
  - ボタンがEnterキーで押せる
  - フォーム送信がEnterキーで可能

- [ ] **Escapeキーでモーダルを閉じる**
  - すべてのモーダルがEscapeキーで閉じる

- [ ] **Skip to Content リンク**
  - Tabキーを押すと「メインコンテンツへスキップ」リンクが表示
  - クリックするとメインコンテンツにジャンプ

### スクリーンリーダー

- [ ] **macOS VoiceOver でテスト**
  1. VoiceOver を起動（Cmd + F5）
  2. すべてのテキストが読み上げられる
  3. ボタンのラベルが適切
  4. フォーム要素にラベルがある
  5. 画像にalt属性がある

- [ ] **Windows NVDA でテスト**（オプション）
  - NVDAをインストール
  - すべての要素が適切に読み上げられる

### ARIA 属性

- [ ] **ARIA ラベルが適切**
  - ボタンに `aria-label` がある（アイコンのみの場合）
  - モーダルに `role="dialog"` と `aria-modal="true"`
  - ライブリージョンに `aria-live` がある

### カラーコントラスト

- [ ] **WCAG AA 基準を満たす**
  - 通常テキスト: 4.5:1 以上
  - 大きなテキスト: 3:1 以上
  - Chrome DevTools > Elements > Contrast ratio で確認

### アニメーション削減

- [ ] **prefers-reduced-motion に対応**
  1. macOS: システム環境設定 > アクセシビリティ > ディスプレイ > 視差効果を減らす
  2. Windows: 設定 > 簡単操作 > ディスプレイ > アニメーションを表示する（オフ）
  3. すべてのアニメーションが無効化または最小化される

---

## ブラウザ互換性テスト

### デスクトップブラウザ

- [ ] **Chrome（最新版）**
  - すべての機能が正常に動作
  - レイアウトが崩れない

- [ ] **Firefox（最新版）**
  - すべての機能が正常に動作
  - レイアウトが崩れない

- [ ] **Safari（最新版）**
  - すべての機能が正常に動作
  - レイアウトが崩れない
  - Webkit特有の問題がない

- [ ] **Edge（最新版）**
  - すべての機能が正常に動作
  - レイアウトが崩れない

### モバイルブラウザ

- [ ] **iOS Safari**
  - iPhone/iPadでテスト
  - レスポンシブデザインが機能
  - タッチ操作が正常

- [ ] **Android Chrome**
  - Androidデバイスでテスト
  - レスポンシブデザインが機能
  - タッチ操作が正常

---

## モバイル対応テスト

### レスポンシブデザイン

- [ ] **ビューポートサイズ**
  - 320px（iPhone SE）
  - 375px（iPhone 12/13）
  - 414px（iPhone 12 Pro Max）
  - 768px（iPad）
  - 1024px（iPad Pro）
  - 1280px以上（デスクトップ）

- [ ] **モバイルナビゲーション**
  - サイドバーが適切に表示される
  - メニューがタップ可能
  - スクロールが正常

- [ ] **フォーム入力**
  - モバイルキーボードが適切に表示
  - 入力欄が十分な大きさ
  - ズームが不要

- [ ] **タッチ操作**
  - ボタンのタップ領域が十分（最低44x44px）
  - スワイプ操作が機能
  - ピンチズームが無効化されていない（必要な場合のみ）

### モバイルパフォーマンス

- [ ] **3G環境でのテスト**
  - Chrome DevTools > Network > Slow 3G
  - ページが5秒以内に表示される
  - ローディング状態が適切に表示される

---

## エラーハンドリングテスト

### ネットワークエラー

- [ ] **オフライン時の動作**
  1. DevTools > Network > Offline
  2. ページ更新
  3. 適切なエラーメッセージが表示される

- [ ] **APIエラー時の動作**
  - エラートーストが表示される
  - ユーザーフレンドリーなメッセージ
  - 技術的詳細が露出しない

### バリデーションエラー

- [ ] **フォームバリデーション**
  - 必須フィールドの検証
  - メールアドレス形式の検証
  - パスワード長の検証
  - エラーメッセージが適切に表示

### 404エラー

- [ ] **存在しないページにアクセス**
  - カスタム404ページが表示される
  - トップページへのリンクがある

### エラーバウンダリ

- [ ] **予期しないエラー時の動作**
  - エラーバウンダリがキャッチ
  - エラーページが表示される
  - Sentryにエラーログが送信される（設定している場合）

---

## セキュリティテスト

### 認証・認可

- [ ] **未認証ユーザーのアクセス制限**
  - `/dashboard` に直接アクセスするとログインページにリダイレクト
  - `/settings` に直接アクセスするとログインページにリダイレクト

- [ ] **セッション管理**
  - ログアウト後は認証が必要なページにアクセスできない
  - 別のブラウザでログインしても影響しない

### HTTPS

- [ ] **HTTPS強制**
  - HTTPでアクセスするとHTTPSにリダイレクト
  - SSL証明書が有効
  - Mixed Content 警告がない

### XSS対策

- [ ] **ユーザー入力のサニタイズ**
  - フォーム入力に `<script>alert('XSS')</script>` を入力
  - スクリプトが実行されない
  - エスケープされて表示される

### CSRF対策

- [ ] **フォーム送信時のトークン検証**
  - Next.js App Routerがデフォルトで保護
  - クロスオリジンリクエストが拒否される

---

## 最終確認

デプロイ完了前に以下をすべて確認してください：

### 機能テスト
- [ ] 認証機能が正常に動作
- [ ] ダッシュボードが正常に表示
- [ ] クレジット購入が成功
- [ ] AI機能が正常に動作
- [ ] 画像生成が成功
- [ ] お問い合わせフォームが機能
- [ ] 設定変更が反映される

### パフォーマンス
- [ ] Lighthouseスコアが90点以上
- [ ] Core Web Vitalsが基準値内
- [ ] ページ読み込み速度が適切

### アクセシビリティ
- [ ] キーボードナビゲーションが機能
- [ ] スクリーンリーダー対応
- [ ] カラーコントラストが基準値内

### ブラウザ互換性
- [ ] Chrome, Firefox, Safari, Edgeで動作
- [ ] iOS, Androidで動作

### セキュリティ
- [ ] 認証・認可が機能
- [ ] HTTPSが強制
- [ ] XSS/CSRF対策が有効

---

## テスト結果の記録

テスト実施日: ___________

テスト実施者: ___________

### 発見された問題

| 番号 | 問題内容 | 重要度 | ステータス |
|------|----------|--------|------------|
| 1    |          |        |            |
| 2    |          |        |            |
| 3    |          |        |            |

### 総合評価

- [ ] すべてのテストに合格
- [ ] 本番環境リリース可能

---

**注意**: このチェックリストは定期的に見直し、新機能追加時には更新してください。
