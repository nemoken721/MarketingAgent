# WordPress構築機能 - マイグレーション&テストチェックリスト

## ⚡ クイックスタート

### ステップ1: Supabaseマイグレーション実行（5分）

1. [Supabase Dashboard](https://supabase.com/dashboard/project/jyshmxtkjqecomrxmber) にアクセス
2. 左サイドバー → **SQL Editor** をクリック
3. **New Query** ボタンをクリック
4. 以下のファイルの内容を全てコピー&ペースト:
   ```
   supabase/migrations/20260102_wordpress_builder_extension.sql
   ```
5. **Run** ボタンをクリック
6. ✅ 成功メッセージを確認

### ステップ2: 開発サーバー起動

```bash
npm run dev
```

ブラウザで http://localhost:3000 を開く

### ステップ3: 会話フローテスト

#### テスト1: ロードマップ表示とドメイン名質問

**入力:** 「ホームページを作りたい」

**期待される動作:**
- [ ] 4ステップのロードマップが表示される
- [ ] AIが「まずはステップ1の『住所決め』から始めましょう！」と言う
- [ ] **「どんな名前のお店にしたいですか？」と質問で終わる**（重要！）

**スクリーンショット:**
```
┌─────────────────────────────────────┐
│ [🏗️ ホームページ構築ロードマップ]  │
│                                     │
│ ① 住所と土地の確保 [現在ここ]       │
│ ② DNS設定                          │
│ ③ お店の建設                       │
│ ④ 内装・開店                       │
└─────────────────────────────────────┘

Marty: まずはステップ1の『住所決め』から始めましょう！

ネット上にお店を出すには、現実と同じで「住所（ドメイン）」と
「土地（サーバー）」の2つがどうしても必要になります。

どんな名前のお店にしたいですか？
例えば「tanaka-bakery.com」のように、希望のドメイン名を教えてください。
空いているか確認します！
```

---

#### テスト2: ドメイン検索

**入力:** 「example-test-123.com が使えるか調べて」

**期待される動作:**
- [ ] 「検索中...」が表示される
- [ ] 検索結果が表示される（利用可能 or 取得済み）
- [ ] 次のアクション（取得方法の案内 or 別名の提案）が提示される

**利用可能な場合の表示例:**
```
✅ example-test-123.com は利用可能です！

お名前.comやムームードメインで取得できます。
取得したら教えてくださいね！

次は、サーバー（土地）の準備です。
XserverかConoHa WINGがおすすめですが、どちらか決まっていますか？
```

---

#### テスト3: 既に取得済みドメインの場合

**入力:** 「google.com が使えるか調べて」

**期待される動作:**
- [ ] 「⚠️ google.com は既に取得されています」が表示される
- [ ] 別の名前を提案するよう促される

**表示例:**
```
⚠️ google.com は既に取得されています

別の名前を考えましょう！
お店の名前や、提供しているサービスにちなんだ名前はどうでしょうか？
```

---

#### テスト4: DNS設定ガイド表示

**入力:** 「お名前.comで取得したドメインとXserverを紐付けたい」

**期待される動作:**
- [ ] DNSGuideCardが表示される
- [ ] お名前.com用の手順が表示される
- [ ] Xserverのネームサーバー2つが表示される
- [ ] 各ネームサーバーに「コピー」ボタンがある
- [ ] ログインURLボタンがある

**表示例:**
```
┌─────────────────────────────────────┐
│ 🌐 DNS設定ガイド                   │
│                                     │
│ サーバー: Xserver                  │
│ ドメイン取得先: お名前.com         │
│                                     │
│ ネームサーバー:                    │
│ ns1.xserver.jp [コピー]            │
│ ns2.xserver.jp [コピー]            │
│                                     │
│ [お名前.comにログイン]             │
│                                     │
│ ▼ 設定手順を表示                   │
└─────────────────────────────────────┘
```

---

#### テスト5: サーバー認証情報フォーム表示

**入力:** 「サーバー情報を入力したい」

**期待される動作:**
- [ ] ServerAuthFormが表示される
- [ ] SSHホスト名、ユーザー名、パスワード入力欄がある
- [ ] パスワード表示/非表示ボタンがある
- [ ] 「どこで確認できる？」ヒントボタンがある
- [ ] 送信ボタンが「接続テストして保存」となっている

---

#### テスト6: SSH接続テスト（オプション - 実際のサーバー情報が必要）

**前提条件:** Xserverの実際のSSH情報を用意

**入力手順:**
1. 上記のフォームに実際のSSH情報を入力
2. 「接続テストして保存」ボタンをクリック

**期待される動作:**
- [ ] 「接続テスト中...」が表示される（スピナーアニメーション）
- [ ] 30秒以内に結果が返る
- [ ] 成功時: 「✅ サーバー接続情報を保存しました！」
- [ ] 失敗時: エラーメッセージが表示される

**成功時のメッセージ例:**
```
✅ サーバー接続情報を保存しました！

鍵を安全にお預かりしました。これでいつでも工事に入れます。
次はいよいよWordPressの建設ですね！
```

---

## 🐛 よくあるエラーと対処法

### エラー1: マイグレーション実行時

**症状:**
```
ERROR: column "server_host" of relation "websites" already exists
```

**対処:** すでに実行済みです。問題ありません。スキップしてOK。

---

### エラー2: ドメイン検索がタイムアウト

**症状:**
```
⏱️ ドメイン検索がタイムアウトしました
```

**原因:** WHOISサーバーが応答しない、または制限中

**対処:**
1. 少し時間をおいてから再試行
2. 別のドメイン名で試す
3. 10秒以内に応答がない場合は自動的にタイムアウト

---

### エラー3: SSH接続テスト失敗

**症状:**
```
❌ ホスト名が見つかりません
```

**確認項目:**
- [ ] SSHホスト名が正しいか（例: `sv12345.xserver.jp`）
- [ ] ポート番号が22か
- [ ] Xserverのサーバーパネルで確認

**症状:**
```
❌ 認証に失敗しました
```

**確認項目:**
- [ ] SSHユーザー名が正しいか（例: `example_com`）
- [ ] SSHパスワードが正しいか（メールを確認）
- [ ] パスワードに特殊文字が含まれている場合、コピペ推奨

---

## 📊 テスト完了チェックリスト

### 必須テスト
- [ ] マイグレーション実行成功
- [ ] 開発サーバー起動成功
- [ ] ロードマップ表示成功
- [ ] **ドメイン名を聞かれる**（会話フロー改善の確認）
- [ ] ドメイン検索機能動作
- [ ] DNS設定ガイド表示成功
- [ ] サーバー認証フォーム表示成功

### オプションテスト（実際のサーバー情報がある場合）
- [ ] SSH接続テスト成功
- [ ] 暗号化保存成功
- [ ] Supabaseに保存されたデータ確認

---

## 📝 テスト結果報告フォーマット

テスト完了後、以下の形式でフィードバックをお願いします:

```
## テスト結果

### 必須テスト
- ロードマップ表示: ✅ / ❌
- ドメイン名質問: ✅ / ❌（重要！）
- ドメイン検索: ✅ / ❌
- DNS設定ガイド: ✅ / ❌
- サーバー認証フォーム: ✅ / ❌

### 気づいた点・改善要望
（自由記述）

### スクリーンショット
（可能であれば添付）
```

---

## 🎯 次のステップ

すべてのテストが ✅ になったら:

1. **Phase 1 完了報告**
2. **Phase 2 要件定義開始**
   - WordPress自動インストールスクリプト
   - SSL証明書自動取得（Let's Encrypt）
   - 構築進捗リアルタイム表示
   - エラーハンドリング強化

---

**作成日:** 2026-01-02
**対象Phase:** Phase 1（UI基盤とGenerative UI）
